<script type="text/ng-template" id="QuestionFormTemplate" ng-controller="QuestionFormController">
  <link rel="stylesheet" type="text/css" href="{{csspath}}" />
  <div class="ui modal qb-question-bank fullscreen active" ng-init="init()">
    <div class="header">
      <div class="ui two column grid">
        <div class="row">
          <div class="column">
            <span>Question Set</span>
          </div>
        </div>
      </div>
    </div>
    <div class="content wizard">
      <div class="qb-filters-container" ng-show="!isQuestionSetConfig">
        <div class="ui form">
          <div class="field">
            <div class="ui fluid icon input">
              <input ng-model="filterObj.question_title" placeholder="Search by question, or question title" ng-keypress="$event.keyCode === 13 ? searchQuestions() : null" type="text" id="qb-search-box" ng-click="generateTelemetry({type: 'select', subtype: 'keyPress', id: 'text'},$event)" />
              <i class="inverted circular search link icon" id="qb-search-button" ng-click="searchQuestions();generateTelemetry({type: 'select', subtype: 'keyPress', id: 'text'},$event)"></i>
            </div>
          </div>
          <div class="ui accordion field">
            <div class="content transition">
              <div class="three fields">
                <div class="field">
                  <div class="ui fluid labeled input">
                    <div class="ui label">Language</div>
                    <select class="ui fluid dropdown search" ng-model="filterObj.language" ng-options="lang for lang in languages" id="language-drop-down" ng-change="searchQuestions();generateTelemetry({type: 'select', subtype: 'dropDown', 'id': 'dropDown'},'language-drop-down')">
                      <option value="">
                        All
                      </option>
                    </select>
                  </div>
                </div>
                <div class="field">
                  <div class="ui fluid labeled input">
                    <div class="ui label">Difficulty</div>
                    <select class="ui fluid dropdown search" ng-model="filterObj.qlevel" ng-options="level for level in difficultyLevels" id="difficulty-drop-down" ng-change="searchQuestions();generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},'difficulty-drop-down')">
                      <option value="">
                        All
                      </option>
                    </select>
                  </div>
                </div>
                <div class="field">
                  <div class="ui fluid labeled input">
                    <div class="ui label">Question Type</div>
                    <select multiple="" class="ui fluid dropdown search lableCls" ng-model="filterObj.type" ng-options="type for type in questionTypes" id="question-type-drop-down" ng-change="searchQuestions();generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},'question-type-drop-down')">
                      <option value="">
                        All
                      </option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="three fields">
                <div class="field">
                  <div class="ui fluid labeled input">
                    <div class="ui label">&emsp;Grade&nbsp;&nbsp;&nbsp;</div>
                    <select multiple="" class="ui fluid dropdown search lableCls" ng-model="filterObj.gradeLevel" ng-options="grade for grade in grades" data-bind="options:assessment.gradeLevel" id="grade-drop-down" ng-click="" ng-change="searchQuestions();generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},'grade-drop-down')">
                      <option value="">
                        All
                      </option>
                    </select>
                  </div>
                </div>
                <div class="field">
                  <div class="ui fluid labeled input">
                    <div class="ui label">Concepts</div>
                    <input type="text" class="fluid" id="queSetConceptsTextBox" placeholder="Choose concepts" ng-model="filterObj.concepts" placeholder="Choose Concept" id="concepts-drop-down" ng-change="searchQuestions();generateTelemetry({type: 'click', subtype: 'select', id: 'dropDown'},'concepts-drop-down')" readonly="true" />
                    <!-- <span class="disabled">{{totalconcepts}} concept(s) choosen</span> -->
                    <!-- <small ng-show="qcconcepterr">Select concept</small> -->
                  </div>
                </div>
                <div class="field">
                  <span class="ui label qb-toggle-label">My Questions</span>
                  <div class="ui fluid toggle checkbox verticalcenter">
                    <input type="checkbox" ng-model="filterObj.myQuestions" ng-change="searchQuestions();">
                    <label>&nbsp;</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="qb-filters-container" ng-show="isQuestionSetConfig">
        <div class="ui form">
          <div class="five fields">
            <div ng-class="questionSetConfigObj.title ? 'field' :'field error'">
              <div class="ui corner labeled input">
                <input name="title" ng-model="questionSetConfigObj.title" type="text" placeholder="Question Set Title" maxlength="100" autocomplete="off">
                <div class="ui corner label">
                  <i class="asterisk icon"></i>
                </div>
              </div>
            </div>
            <div class="field">
              <div class="ui fluid labeled input">
                <div class="ui label">Max score</div>
                <input class="total-marks ui dropdown" id="max_score" name="max_score" ng-model="questionSetConfigObj.max_score" min='0' required="" type="number" ng-click="generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},$event)" />
              </div>
            </div>
            <div>
              <div class="ui fluid labeled input displayCount">
                <div class="ui label">Display</div>
                <select class="ui fluid dropdown" id="total_items" ng-model="questionSetConfigObj.total_items" ng-options="option as option for option in itemRange" ng-click="generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},$event)">
                </select>
              </div>
            </div>
            <div class="field">
              <div class="ui toggle checkbox verticalcenter">
                <input type="checkbox" ng-model="questionSetConfigObj.show_feedback" id="show-feedback" ng-click="generateTelemetry({type: 'click', subtype: 'toggle', id: 'checkbox'},$event)" />
                <label>Show Immediate Feedback</label>
              </div>
            </div>
            <div class="field">
              <div class="ui toggle checkbox verticalcenter">
                <input type="checkbox" ng-model="questionSetConfigObj.shuffle_questions" id="shuffle0questions" ng-click="generateTelemetry({type: 'click', subtype: 'toggle', id: 'checkbox'},$event)" />
                <label>Shuffle Questions</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="ui divider"></div>
      <div class="ui segment" ng-show="itemsLoading">
        <div class="ui active inverted dimmer">
          <div class="ui text loader">Just one second, We re fetching that content for you.</div>
        </div>
      </div>
      <div class="qb-questions-list">
        <div class="ui two column horizontally padded grid" ng-show="!itemsLoading">
          <div class="seven wide column qb-question-container" ng-show="!isQuestionSetConfig">
            <div class="row qb-question-list-container" ng-init="getUnselectedQuestionList()">
              <div class="ui large divided items">
                <div class="item select" ng-repeat="question in selectedQuestions">
                  <div class="middle aligned content" ng-click="previewItem(question, true);">
                    <div class="header">{{ question.title }}</div>
                    <div class="meta">{{question.language}} | {{ question.type}} | {{ question.qlevel }}</div>
                    <div class="description">{{ question.description }}</div>
                  </div>
                  <div>
                    <input type="checkbox" checked="" name="check" ng-model="question.isSelected" id="select-question" ng-click="removeQuestion(question);generateTelemetry({type: 'click', subtype: 'toggle', id: 'checkbox'},$event)">
                    <button class="mini ui button" ng-click="editQuestion(question)" id="edit-question-button" ng-click="generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)">
                      Edit
                    </button>
                  </div>
                </div>
                <div class="item select" ng-repeat="question in unselectedQuestions">
                  <div class="middle aligned content" ng-click="previewItem(question, true);">
                    <div class="header">{{ question.title }}</div>
                    <div class="meta">{{question.language}} | {{ question.type}} | {{ question.qlevel }}</div>
                    <div class="description">{{ question.description }}</div>
                  </div>
                  <div>
                    <input type="checkbox" checked="" name="check" ng-model="question.isSelected" id="select-question" ng-click="selectQuestion(question);generateTelemetry({type: 'click', subtype: 'toggle', id: 'checkbox'},$event)">
                    <button class="mini ui button" ng-click="editQuestion(question)" id="edit-question-button" ng-click="generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)">
                      Edit
                    </button>
                  </div>
                </div>
                <div ng-show="questions.length == 0">
                  <p>No Data Found Redefine your search filters!.</p>
                  Please click on "Create question" button to create new question
                </div>
              </div>
            </div>
          </div>
          <div class="seven wide column column qb-question-container" ng-show="isQuestionSetConfig">
            <div class="column qb-list-container" ng-show="isQuestionSetConfig">
              <div class="ui large divided items">
                <div class="item select" ng-repeat="selQuestion in selectedQuestions" ng-class="{quesSelector: $index === selectedIndex}">
                  <div class="middle aligned content" ng-click="previewItem(selQuestion, true);">
                    <div class="header">{{ selQuestion.config.metadata.title }}</div>
                    <div class="meta">{{selQuestion.config.metadata.language}} | {{ selQuestion.config.metadata.type}} | {{ selQuestion.config.metadata.difficulty }}</div>
                    <div class="description">{{ selQuestion.config.metadata.description }}</div>
                  </div>
                  <div>
                    <span><i class="edit icon" id="edit-question-config" ng-click="editConfig(selQuestion, $index);generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)"></i></span>
                  </div>
                  <div>
                    <span><i class="remove icon" id="remove-question-button" ng-click="removeQuestion(selQuestion);generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)"></i></span>
                  </div>
                </div>
                <div ng-show="selectedQuestions.length == 0">
                  <p>No questions selected</p>
                </div>
              </div>
            </div>
          </div>
          <div class=" four widecolumn preview-config">
            <div class="qb-config-form" ng-show="showConfigForm">
              <h3>Config Data</h3>
              <div class="ui form">
                <div class="fields">
                  <!-- <div class="field">
                  <label>Max time</label>
                  <input type="number" placeholder="In minutes" id="max-time" ng-model="selQuestionObj.config.max_time" ng-click="generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},$event)">
                </div> -->
                  <div class="field">
                    <label>Score</label>
                    <input type="number" ng-model="selQuestionObj.config.max_score" id="max-score" ng-click="generateTelemetry({type: 'select', subtype: 'dropDown', id: 'dropDown'},$event)" ng-change="saveConfig()">
                  </div>
                </div>
              </div>
              <!-- <div class="ui form">
              <div class="fields">
                <div class="inline field">
                  <div class="ui checkbox">
                    <label>Partial Scoring</label>
                    <input type="checkbox" name="partialScoring" id="partial-scoring" ng-click="generateTelemetry({type: 'click', subtype: 'toggle', id: 'checkbox'},$event)">
                  </div>
                </div>
              </div>
            </div> -->
              <!--  <div class="ui submit button" id="save-config" ng-click="saveConfig();generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)">Submit</div> -->
            </div>
            <iframe id="itemIframe" class="previewContainer" ng-show="!itemPreviewLoading && (itemPreviewContent.error || (itemPreviewDisplay == itemPreviewDefaultMessage))"></iframe>
            <!-- Preview code
            <iframe id="itemIframe" class="previewContainer" ng-hide="!itemPreviewLoading && (itemPreviewContent.error || (itemPreviewDisplay == itemPreviewDefaultMessage))"></iframe>
            <div>
              <div class="itemIframeMessages" ng-show="!itemPreviewLoading && (itemPreviewContent.error || (itemPreviewDisplay == itemPreviewDefaultMessage))">{{itemPreviewDisplay}}</div>
            </div> -->
          </div>
        </div>
      </div>
      <div class="ui center aligned segment" ng-show="(items && !items.length) && isAdvanceOptionOpen">
        No Data Found
        <br> Redefine your search filters!
      </div>
    </div>
    <div class="actions">
      <button class="ui blue left floated button" ng-show="!isQuestionSetConfig" id="create-question-button" ng-click="createQuestion();generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)">Create question</button>
      <button class="ui orange button" id="cancel-button" ng-click="cancel();generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)" ng-show="isQuestionSetConfig" type="button">Cancel</button>
      <div class="ui buttons">
        <button class="ui orange button" id="cancel-qs-button" ng-click="cancel();generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)" ng-show="!isQuestionSetConfig" type="button">Cancel</button>
        <!-- <div class="or" ng-show="isQuestionSetConfig"></div> -->
        <button class="ui orange button" id="add-more-ques-button" ng-click="isQuestionSetConfig = false;generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event);closeConfigForm()" ng-show="isQuestionSetConfig" type="button">Add More Questions</button>
        <div class="or"></div>
        <button class="ui blue button" ng-show="!isQuestionSetConfig" id="next-button" ng-disabled="selectedQuestions.length==0" ng-click="createQuestionSet();generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)" type="button">Next</button>
        <button class="ui blue button" ng-disabled="(questionSetConfigObj.title == '')" ng-show="isQuestionSetConfig" id="add-to-stage" ng-click="addQuestionSet();generateTelemetry({type: 'click', subtype: 'select', id: 'button'},$event)" type="button">Add</button>
      </div>
    </div>
  </div>