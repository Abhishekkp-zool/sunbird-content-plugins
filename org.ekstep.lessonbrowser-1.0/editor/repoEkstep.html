<div ng-app="org.ekstep.contentprovider" ng-controller="contentproviderekstepController as $ctrl" id="partials/repoEkstep.html">

<style type="text/css">
	.source-result-container {max-height: 440px; overflow-y: scroll;}
	.source-filter-container {max-height: 365px; overflow-y: scroll;}

	.lesson-row{border-bottom: 1px solid #ddd}
	.lesson-lang-separator {margin-left: 5px; margin-right: 5px;}

</style>

<div class="ui grid">
  	<div class="row" ng-if="$ctrl.err">
    	<div class="column">
    		{{ $ctrl.err }}
    	</div>
  	</div>
	<div class="row" ng-if="!$ctrl.err">
    	<div class="column">
    		<div class="ui fluid action input">
				<input type="text" placeholder="Search for keyword" autocomplete="off" spellcheck="false" ng-model="searchKeyword">
		    	<button class="ui button" ng-click="searchByKeyword()">Search</button>
		    	<button class="ui button" ng-click="resetSearchByKeyword()">Reset</button>
			</div>
    	</div>
  	</div>
  	<div class="row" ng-if="!$ctrl.err">
  		<!-- Filters start -->
	  	<div class="four wide column">
	  		<div class="row">
	  			<h4>Filters</h4>
	  			<div class="ui divider"></div>
	  		</div>
	  		<div class="ui styled accordion source-filter-container" style="margin-top: 5px; margin-bottom: 5px;">
			  	<div class="title">
			    	<i class="dropdown icon"></i>
			    	Language ({{langSelection.length}})
			  	</div>
			  	<div class="content">
				    <div class="ui list">
						<!-- <div class="item ui checkbox"><input type="checkbox"><label><strong>Select all</strong></label></div> -->
						<div class="item ui checkbox" ng-repeat="lang in $ctrl.meta.languages"><input type="checkbox" value="{{lang.value}}" name="selectedLangs[]" ng-checked="langSelection.indexOf(lang.value) > -1" ng-click="toggleSelection(langSelection, lang.value)"><label>{{lang.label}}</label></div>
					</div>
			  	</div>
			  	<div class="title">
			    	<i class="dropdown icon"></i>
			    	Grade ({{gradeSelection.length}})
			  	</div>
			  	<div class="content">
			  		<div class="ui list">
				    	<!-- <div class="item ui checkbox"><input type="checkbox"><label><strong>Select all</strong></label></div> -->
						<div class="item ui checkbox" ng-repeat="grade in $ctrl.meta.grades"><input type="checkbox" value="{{grade.label}}" name="selectedGrades[]" ng-checked="gradeSelection.indexOf(grade.label) > -1" ng-click="toggleSelection(gradeSelection, grade.label)"><label>{{grade.label}}</label></div>
					</div>
			  	</div>
				<div class="title">
					<i class="dropdown icon"></i>
					Lesson type ({{lessonTypeSelection.length}})
				</div>
				<div class="content">
					<div class="ui list">
						<!-- <div class="item ui checkbox"><input type="checkbox"><label><strong>Select all</strong></label></div> -->
						<div class="item ui checkbox" ng-repeat="lessonType in $ctrl.meta.lessonTypes"><input type="checkbox" value="{{lessonType}}" name="selectedLessonTypes[]" ng-checked="lessonTypeSelection.indexOf(lessonType) > -1" ng-click="toggleSelection(lessonTypeSelection, lessonType)"><label>{{lessonType}}</label></div>
					</div>
				</div>
				<div class="title">
					<i class="dropdown icon"></i>
					Domain ({{domainSelection.length}})
				</div>
				<div class="content">
					<div class="ui list">
						<!-- <div class="item ui checkbox"><input type="checkbox"><label><strong>Select all</strong></label></div> -->
						<div class="item ui checkbox" ng-repeat="domain in $ctrl.meta.domains"><input type="checkbox" value="{{domain}}" name="selectedDomains[]" ng-checked="domainSelection.indexOf(domain) > -1" ng-click="toggleSelection(domainSelection, domain)"><label style="text-transform: capitalize;">{{domain}}</label></div>
					</div>
				</div>
				<div class="title">
					<i class="dropdown icon"></i>
					Concept
				</div>
				<div class="content">
					Chose Concept
				</div>
				<!-- <div class="title">
					<i class="dropdown icon"></i>
					Ownership
				</div>
				<div class="content">
					<select class="ui fluid dropdown">
						<option value="1">Everyone's lesson</option>
						<option value="1">My lessons</option>
						<option value="3">Lessons I am collaborating</option>
					</select>
				</div> -->
				<!-- <div class="title">
					<i class="dropdown icon"></i>
					Date
				</div>
				<div class="content">
					<select class="ui fluid dropdown">
						<option value="1">Select date type</option>
						<option value="1">Created date</option>
						<option value="1">Updated date</option>
						<option value="1">Published date</option>
						<option value="1">Submitted date</option>
					</select>
					<select class="ui fluid dropdown">
						<option value="1">Select lesson ordering</option>
						<option value="1">Latest first</option>
						<option value="3">Oldest first</option>
					</select>
				</div> -->
			</div>
		  	<div class="row">
		  		<button class="ui right floated button primary" ng-click="applyFilters()">Apply</button>
				<button class="ui left floated button">Reset</button>
		  	</div>
	  	</div>
	  	<!-- Filters end -->
	  	<!-- Result start -->
		<div class="eight wide column">
			<div class="row">
	  			<h4>Lessons
	  			<span style="font-size: 0.8em">({{ $ctrl.res.count }})</span>
	  			</h4>
	  			<div class="ui divider"></div>
	  		</div>
			<div class="ui grid source-result-container">
				<div class="row lesson-row" ng-repeat="lesson in $ctrl.res.content">
					<div class="three wide column" style="padding-top: 3px;">
						<div class="ui checkbox">
							<input type="checkbox" name="lessons[]" ng-click="toggleSelection(lessonSelection, lesson.identifier)">
							<label>
								<img class="ui middle aligned tiny right floated image" src="{{lesson.appIcon}}" ng-if="lesson.appIcon">
								<img class="ui middle aligned tiny right floated image" src="http://via.placeholder.com/80x80" ng-if="!lesson.appIcon">
							</label>
						</div>
					</div>
					<div class="eight wide column">
						<div><h3>{{lesson.name}}</h3></div>
						<div>{{ lesson.contentType }}</div>
						<div>
							<span ng-repeat="lang in lesson.language"><span ng-if="!$first" class="lesson-lang-separator">|</span>{{lang}}</span>
						</div>
						<div>{{lesson.description | removeHTMLTags | cut:true:120:' ...'}}</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Result end -->
  	</div>
  	<div class="row">
    	<div class="column">
    		<button class="ui right floated button primary" ng-click="addSelectedLessons()">Add</button>
			<button class="ui right floated button" ng-click="closePopup()">Cancel</button>
    	</div>
  	</div>
  	<div class="row" ng-if="noLessonSelected">
    	<div style="width: 100%; text-align: right; margin-right: 15px; color: #ff0000;">Please select at least one lesson</div>
  	</div>
</div>
</div>