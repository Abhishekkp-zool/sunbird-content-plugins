org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.image","ver":"1.1","shortId":"image","displayName":"Image","author":"Santhosh Vasabhaktula","title":"Image Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","help":{"src":"editor/help.md","dataType":"text"},"dependencies":[{"type":"plugin","plugin":"org.ekstep.assetbrowser","ver":"1.2"}],"menu":[{"id":"image","category":"main","type":"icon","toolTip":"Add Image","title":"Image","iconClass":"fa fa-picture-o","onclick":{"id":"org.ekstep.image:assetbrowser:open"}}],"behaviour":{"rotatable":true},"configManifest":[{"propertyName":"imagebrowser","title":"Image Browser","description":"Choose a  from the browser","dataType":"browser","required":true,"onclick":{"id":"org.ekstep.assetbrowser:show","type":"image"}},{"propertyName":"clipimage","title":"Clipimage","placeholder":"ClipImage","description":"Clip the image","dataType":"clipimage","valueType":"number","required":true,"onclick":{"id":"org.ekstep.image:clipimage:create","type":"clipimage"}},{"propertyName":"doneclipimage","title":"DoneClipImage","placeholder":"DoneClipImage","description":"Done Clipping the image","dataType":"doneclipimage","valueType":"number","required":true,"onclick":{"id":"org.ekstep.image:doneclipimage:create","type":"doneclipimage"}}]}},org.ekstep.contenteditor.basePlugin.extend({name:"Image",initialize:function(){ecEditor.addEventListener(this.manifest.id+":assetbrowser:open",this.openBrowser,this),ecEditor.addEventListener("org.ekstep.image:clipimage:create",this.clipImage,this),ecEditor.addEventListener("org.ekstep.image:doneclipimage:create",this.clipImage,this)},doneClipImage:function(e,t){console.log("inside doneclipimage")},clipImage:function(e,t){var i;this.clipMask;var r=org.ekstep.contenteditor.api.getCanvas();r.remove(this.clipMask);if(this.currentObject,this.lastActiveObject,"clipimage"==t.type)ecEditor.getCurrentObject()?(this.currentObject=ecEditor.getCurrentObject(),i=fabric.util.object.clone(this.currentObject),console.log(i.editorObj),this.lastActiveObject!=this.currentObject?(console.log("different Object"),r.remove(this.clipMask)):console.log("same object"),this.clipMask=new fabric.Rect({fill:"rgba(0,0,0,0.3)",originX:"left",originY:"top",stroke:"#333",strokeWidth:5,strokeDashArray:[54,2],opacity:1,width:1,height:1,borderColor:"#36fd00",cornerColor:"black",cornerStrokeColor:"black",cornerSize:6,cornerShape:"circle",transparentCorners:!1,hasRotatingPoint:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0}),this.clipMask.left=ecEditor.getCurrentObject().editorObj.left,selection_object_left=ecEditor.getCurrentObject().editorObj.left,selection_object_top=ecEditor.getCurrentObject().editorObj.top,this.clipMask.top=ecEditor.getCurrentObject().editorObj.top,this.clipMask.width=ecEditor.getCurrentObject().attributes.w,this.clipMask.height=ecEditor.getCurrentObject().attributes.h,console.log(this.clipMask),r.add(this.clipMask),r.setActiveObject(this.clipMask),ecEditor.render()):console.log("no object is chosen");else if("doneclipimage"==t.type){var s=this.clipMask.get("left"),o=this.clipMask.get("top"),c=s-this.currentObject.left,a=o-this.currentObject.top;c*=1,a*=1;var n=this.clipMask.get("width"),h=this.clipMask.get("height"),d=this.clipMask.get("scaleX"),l=this.clipMask.get("scaleY"),g=1*n,p=1*h,b=this.currentObject?this.currentObject.media[this.currentObject.attributes.asset]:void 0;if(!b||!b.src)throw new Error("media source is missing!");b.src=ecEditor.getMediaReverseProxyURL(b.src);var u=ecEditor.getConfig("useProxyForURL")?"image/get/"+encodeURIComponent(b.src):b.src;fabric.Image.fromURL(u,function(e){}),this.currentObject.set({clipTo:function(e){e.rect(-n/2+c,-h/2+a,parseInt(g*d),parseInt(l*p))}})}},newInstance:function(){var t=this,i=this.parent;this.parent=void 0;var r=this.convertToFabric(this.attributes);"plugin"==this.attributes.from&&(delete r.width,delete r.height);var e=this.media?this.media[this.attributes.asset]:void 0;if(!e||!e.src)throw new Error("media source is missing!");if(e&&e.src){this.name=this.attributes.asset,e.src=ecEditor.getMediaReverseProxyURL(e.src);var s=ecEditor.getConfig("useProxyForURL")?"image/get/"+encodeURIComponent(e.src):e.src;fabric.Image.fromURL(s,function(e){e.strokeWidth=1,t.editorObj=e,t.parent=i,"plugin"==t.attributes.from&&(t.editorObj.scaleToWidth(r.w),delete t.attributes.from),t.postInit()},r)}},openBrowser:function(){var t=this;ecEditor.dispatchEvent("org.ekstep.assetbrowser:show",{type:"image",search_filter:{},callback:function(e){e.x=20,e.y=20,e.w=50,e.h=50,e.from="plugin",ecEditor.dispatchEvent(t.manifest.id+":create",e)}})},getCopy:function(){var e=this._super();return e.assetMedia=this.media[this.attributes.asset],e},onConfigChange:function(e,t){switch(e){case"browser":ecEditor.dispatchEvent("delete:invoke"),ecEditor.dispatchEvent(this.manifest.id+":create",t)}},getDisplayName:function(){return this.name},clipTo:function(){var e=this._super();return e.assetMedia=this.media[this.attributes.asset],e}}))